



```bash
# 克隆 LLMServingSim 仓库并进入目录
git clone --recurse-submodules https://github.com/casys-kaist/LLMServingSim.git
cd LLMServingSim


fth
'''
git clone git@github.com:TELOS-syslab/LLMServingSim.git
cd LLMServingSim
git submodule update --init --recursive

'''
# 使用 curl 下载并安装 Anaconda (可选)
# 从指定链接下载 Anaconda 安装脚本
curl -O https://repo.anaconda.com/archive/Anaconda3-2024.06-1-Linux-x86_64.sh
# 执行安装脚本
bash Anaconda3-2024.06-1-Linux-x86_64.sh

# 使用 conda 通过 environment.yml 创建环境 (推荐)（fth不适用）
conda env create -p ./env -f ./environment.yml  # 根据 environment.yml 创建 conda 环境
conda activate ./env                           # 激活环境

# 使用 conda 手动安装依赖 (干净安装)(fth使用)
conda create -n env_name python=3.9             # 创建指定 Python 版本的环境
conda activate env_name                         # 激活新环境
conda install conda-forge::libprotobuf=3.6.1    # 安装特定版本的 libprotobuf 库
conda install conda-forge::cmake=3.15           # 安装特定版本的 CMake
conda install cctbx202208::boost-cpp=1.74.0     # 安装特定版本的 boost-cpp

fth:
'''

done
#
# To activate this environment, use
#
#     $ conda activate /mnt/fth/software2/LLMServingSim/env
#
# To deactivate an active environment, use
#
#     $ conda deactivate



conda create -n llm_serving_sim python=3.9 
conda activate llm_serving_sim   
conda install conda-forge::libprotobuf=3.6.1  
conda install conda-forge::cmake=3.15 
conda install cctbx202208::boost-cpp=1.74.0 
'''

pip install -r requirements.txt                 # 使用 pip 安装额外依赖

# 构建 ASTRA-Sim, Chakra, Polymath
cd astra-sim                                      # 进入 astra-sim 目录
./build/astra_analytical/build.sh                 # 执行 ASTRA-Sim 的构建脚本
cd extern/graph_frontend/chakra                   # 进入 Chakra 目录
pip install .                                     # 安装 Chakra 库
cd ../../../../execution_engine/polymath          # 返回并进入 Polymath 目录
pip install .                                     # 安装 Polymath 库
cd ../..                                          # 返回到初始目录

# 设置输入配置

# 配置 & 数据集路径：
# 网络配置路径：`astra-sim/inputs/network/analytical/{config_name}.json`
# NPU 配置路径：`execution_engine/codelets_src/codelets/examples/genesys/configs/{config_name}.json`
# 数据集路径：`astra-sim/dataset/{dataset_name}.tsv`

# 测试运行 LLMServingSim
python3 -u main.py --model_name 'gpt3-6.7b' --npu_num 1 --npu_group 1 --npu_mem 24 --dataset 'dataset/share-gpt-req100-rate10.tsv'  # 运行 gpt3-6.7b 模型
python3 -u main.py --model_name 'llama-7b' --npu_num 1 --npu_group 1 --npu_mem 24 --dataset 'dataset/share-gpt-req100-rate10.tsv'  # 运行 llama-7b 模型

# main.py 参数说明
# | 参数       | 支持选项                               | 默认值       | 备注 |
# | model_name | 模型名称，如 'gpt2', 'gpt3-6.7b' 等    | 'gpt2'      |      |
# | npu_num    | NPU 数量                               | 16          |      |
# | max_batch  | 最大批次                              | 0 (无上限) |      |
# | batch_delay| 批次延迟                              | 0           |      |
# | scheduling | 调度策略                               | 'orca'      |      |
# | parallel   | 并行类型                               | 'hybrid'    |      |
# | npu_group  | NPU 组数量                            | 1           |      |
# | npu_mem    | NPU 内存                              | 40          |      |
# | kv_manage  | kv 管理类型                            | 'vllm'      |      |
# | block_size | 块大小                                | 8           |      |
# | pim_type   | PIM 类型                               | 'none'      |      |
# | sub_batch  | 子批次调度标志                         | False       |      |
# | dataset    | 数据集路径                             | None        |      |
# | network    | 网络配置 JSON 文件名                   | None        |      |
# | output     | 输出 TSV 路径                          | None        |      |
# | gen        | 跳过初始化阶段标志                     | False       |      |
# | fast_run   | 快速运行标志，跳过所有编译使用缓存追踪 | False       |      |

# main.py 输出说明
# 1. 标准输出
# 显示每次迭代处理的请求和定期显示的吞吐量。最后总结吞吐量和仿真时间。

# 2. 吞吐量 TSV 文件
# `{output_filename}-throughput.tsv` 包含每个间隔的提示和生成吞吐量。

# 3. 仿真时间 TSV 文件
# `{output_filename}-simulation-time.tsv` 包含每个组件的仿真时间。

# 评估
cd evaluation                          # 切换到评估文件夹

# 运行各评估脚本
./evaluation1.sh                       # 运行第一个评估脚本
./evaluation2.sh                       # 运行第二个评估脚本
# ...
./evaluation5.sh                       # 运行第五个评估脚本

# 运行所有评估脚本
./evaluation_all.sh                    # 运行所有评估脚本

# 若需详细信息，请参阅 `evaluation` 文件夹中的 `README` 文件。

# 常见错误
# 若出现如下错误，可使用以下方法解决
# /home/<user>/LLMServingSim/astra-sim/extern/graph_frontend/chakra/et_def/et_def.pb.h:17:2: error: #error This file was generated by an older version of protoc which is
# 说明：此错误是由 protoc 版本不兼容引起的

# 方法 1：设置环境变量
conda activate your_env_name                     # 激活 conda 环境
export CMAKE_PREFIX_PATH=$CONDA_PREFIX:$CMAKE_PREFIX_PATH   # 将 conda 环境路径加入到 CMAKE_PREFIX_PATH 变量中

# 方法 2：设置激活脚本
conda activate your_env_name                     # 激活 conda 环境
mkdir -p $CONDA_PREFIX/etc/conda/activate.d      # 创建激活脚本目录
mkdir -p $CONDA_PREFIX/etc/conda/deactivate.d    # 创建反激活脚本目录

# 创建激活脚本 set_cmake_prefix.sh
nano $CONDA_PREFIX/etc/conda/activate.d/set_cmake_prefix.sh
# 在 set_cmake_prefix.sh 文件中添加以下内容
#!/bin/bash
export OLD_CMAKE_PREFIX_PATH=$CMAKE_PREFIX_PATH      # 保存旧的 CMAKE_PREFIX_PATH
export CMAKE_PREFIX_PATH=$CONDA_PREFIX:$CMAKE_PREFIX_PATH  # 设置新的 CMAKE_PREFIX_PATH

# 创建反激活脚本 unset_cmake_prefix.sh
nano $CONDA_PREFIX/etc/conda/deactivate.d/unset_cmake_prefix.sh
# 在 unset_cmake_prefix.sh 文件中添加以下内容
#!/bin/bash
export CMAKE_PREFIX_PATH=$OLD_CMAKE_PREFIX_PATH      # 恢复旧的 CMAKE_PREFIX_PATH
unset OLD_CMAKE_PREFIX_PATH                          # 删除临时变量

# 设定脚本权限
chmod +x $CONDA_PREFIX/etc/conda/activate.d/set_cmake_prefix.sh    # 赋予激活脚本执行权限
chmod +x $CONDA_PREFIX/etc/conda/deactivate.d/unset_cmake_prefix.sh # 赋予反激活脚本执行权限
```

This version adds Chinese comments directly following each line or section, matching the original indentation and structure. This allows the code to be executable as is.